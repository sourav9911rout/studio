/**
 * Core Philosophy: This ruleset establishes a secure data model for 'drugHighlights'.
 * Anonymous users can read the drug highlight data, but only authenticated users
 * can modify it. This supports the PIN-protected edit mode.
 *
 * Data Structure: All data is stored in a single top-level collection: /drugHighlights/{date}.
 * The document ID is the date of the highlight in 'YYYY-MM-DD' format.
 *
 * Key Security Decisions:
 * - Public Read Access: The `drugHighlights` collection is readable by anyone to
 *   support the app's core feature of displaying daily drug information.
 * - Authenticated Write Access: All write operations (`create`, `update`, `delete`) are allowed
 *   only for authenticated users (`request.auth != null`). This provides a basic level of
 *   security for the PIN-protected edit mode, ensuring only users who have passed
 *   some form of authentication (even if anonymous) can attempt to write data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // =====================================================================
    // Helper Functions
    // =====================================================================

    // =====================================================================
    // Collection Rules
    // =====================================================================

    /**
     * @description Provides public read access and authenticated write access to daily drug highlights.
     * @path        /drugHighlights/{date}
     * @allow       read: Any user, authenticated or not, can read drug highlights.
     * @allow       write: Any authenticated user can create, update, or delete a drug highlight.
     * @principle   Secures a public dataset by requiring authentication for all write operations.
     */
    match /drugHighlights/{date} {
      // READ rules: Data is public and can be read by anyone.
      allow read: if true;

      // WRITE rules: Allow writes only if the user is authenticated.
      // This is a basic protection for the PIN-based edit mode.
      allow write: if request.auth != null;
    }
  }
}
